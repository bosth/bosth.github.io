<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Multidimensional data in PostGIS &#183; Benjamin Trigona-Harany | jaxartes.net</title><meta name=title content="Multidimensional data in PostGIS &#183; Benjamin Trigona-Harany | jaxartes.net"><link rel=canonical href=https://www.jaxartes.net/pages/ads-b/><link type=text/css rel=stylesheet href=/css/main.bundle.min.cf0ebc563e7ce1bad70206a8d2b34fe0892c0119b8d4bc6a203e7ae5ae16886c44722334218877aa3e48bc54598500acdc852ccd46e00b1ef5cd533f4c6295eb.css integrity="sha512-zw68Vj584brXAgao0rNP4IksARm41LxqID565a4WiGxEciM0IYh3qj5IvFRZhQCs3IUszUbgCx71zVM/TGKV6w=="><script type=text/javascript src=/js/appearance.min.a75d508cf75a202afc48fe649516720f8036bda3657897f6cc07dab21f94fa9c3933edbbfc2936f8d3a426f45ac6153237a48aec9115147c5e03db1c5b62b8bc.js integrity="sha512-p11QjPdaICr8SP5klRZyD4A2vaNleJf2zAfash+U+pw5M+27/Ck2+NOkJvRaxhUyN6SK7JEVFHxeA9scW2K4vA=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.911bd9741247c092f3a38757ca26b07e6bf319209e5162bbc5a609bae50fa2ea13b3c09f8f2c3d1cfd66c0b6885f0b2137bb43fee6404db177d90abde3c09547.js integrity="sha512-kRvZdBJHwJLzo4dXyiawfmvzGSCeUWK7xaYJuuUPouoTs8Cfjyw9HP1mwLaIXwshN7tD/uZATbF32Qq948CVRw==" data-copy data-copied></script>
<script src=/js/zoom.min.js></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=google-site-verification content="rj6pajYYOfdl4MQOUwnweKW_jDonxKfZGbe2O-Fo3c4"><meta property="og:title" content="Multidimensional data in PostGIS"><meta property="og:description" content="ADS-B data> ADS-B data # Can standard geospatial tools be used with transmissions from Automatic Dependent Surveillance-Broadcast (ADS-B) equipment aboard aircraft? I wanted to find out because unlike most geospatial data, ADS-B has a third dimension and a fourth dimension."><meta property="og:type" content="article"><meta property="og:url" content="https://www.jaxartes.net/pages/ads-b/"><meta property="og:image" content="https://www.jaxartes.net/pages/ads-b/featured.webp"><meta property="article:section" content="pages"><meta property="article:published_time" content="2022-07-01T00:00:00+00:00"><meta property="article:modified_time" content="2022-07-01T00:00:00+00:00"><meta property="og:site_name" content="Benjamin Trigona-Harany | jaxartes.net"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.jaxartes.net/pages/ads-b/featured.webp"><meta name=twitter:title content="Multidimensional data in PostGIS"><meta name=twitter:description content="ADS-B data> ADS-B data # Can standard geospatial tools be used with transmissions from Automatic Dependent Surveillance-Broadcast (ADS-B) equipment aboard aircraft? I wanted to find out because unlike most geospatial data, ADS-B has a third dimension and a fourth dimension."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Pages","name":"Multidimensional data in PostGIS","headline":"Multidimensional data in PostGIS","abstract":"ADS-B data\u003e ADS-B data # Can standard geospatial tools be used with transmissions from Automatic Dependent Surveillance-Broadcast (ADS-B) equipment aboard aircraft? I wanted to find out because unlike most geospatial data, ADS-B has a third dimension and a fourth dimension.","inLanguage":"en","url":"https:\/\/www.jaxartes.net\/pages\/ads-b\/","author":{"@type":"Person","name":"Benjamin Trigona-Harany"},"copyrightYear":"2022","dateCreated":"2022-07-01T00:00:00\u002b00:00","datePublished":"2022-07-01T00:00:00\u002b00:00","dateModified":"2022-07-01T00:00:00\u002b00:00","keywords":["postgis","postgres","geospatial","ads-b","python"],"mainEntityOfPage":"true","wordCount":"3806"}]</script><meta name=author content="Benjamin Trigona-Harany"><link href=https://www.jaxartes.net/ rel=me><link href=mailto:info@jaxartes.net rel=me><link href=https://github.com/bosth rel=me><link href=https://linkedin.com/in/benth rel=me><link href=https://mapstodon.space/@jerseybastion rel=me><link href="https://www.worldcat.org/search?q=Benjamin+Trigona+Harany" rel=me><script src=/lib/jquery/jquery.slim.min.js integrity></script>
<script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="https://matomo.jaxartes.net/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script><noscript><p><img src="https://matomo.jaxartes.net/matomo.php?idsite=1&amp;rec=1" style=border:0 alt></p></noscript><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Benjamin Trigona-Harany | jaxartes.net</a></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12"><a href=/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title="Benjamin Trigona-Harany | jaxartes.net">Home</p></a><a href=/pages/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Pages>Pages</p></a><div class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher type=button><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12"><span></span>
<button id=appearance-switcher-mobile type=button style=margin-right:5px><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-auto overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title="Benjamin Trigona-Harany | jaxartes.net">Home</p></a></li><li class=mt-1><a href=/pages/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Pages>Pages</p></a></li></ul></div></label></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom" style=background-image:url(/pages/ads-b/featured_hu9e952150c6bbf2caadd09eccb3f3bbfa_66970_1200x0_resize_q75_h2_box_2.webp)><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("background-blur");n.style.opacity=t/300})</script><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Multidimensional data in PostGIS</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#ads-b-data>ADS-B data</a><ul><li><a href=#tools>Tools</a></li><li><a href=#aircraft-identities>Aircraft identities</a></li><li><a href=#the-opensky-network>The OpenSky Network</a><ul><li><a href=#state-vectors>State vectors</a></li><li><a href=#tracks>Tracks</a></li><li><a href=#flights>Flights</a></li><li><a href=#airport-activity>Airport activity</a></li></ul></li></ul></li><li><a href=#ads-b-data-in-postgis>ADS-B data in PostGIS</a><ul><li><a href=#database-creation>Database creation</a></li><li><a href=#plpython>PL/Python</a></li><li><a href=#geospatial-queries>Geospatial queries</a></li></ul></li><li><a href=#going-multidimensional>Going multidimensional</a><ul><li><a href=#crossed-paths>Crossed Paths</a></li><li><a href=#four-dimensions>Four dimensions</a><ul><li><a href=#closest-points-of-approach>Closest points of approach</a></li><li><a href=#searching-for-near-misses>Searching for near misses</a></li></ul></li></ul></li></ul></nav></div></details><details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#ads-b-data>ADS-B data</a><ul><li><a href=#tools>Tools</a></li><li><a href=#aircraft-identities>Aircraft identities</a></li><li><a href=#the-opensky-network>The OpenSky Network</a><ul><li><a href=#state-vectors>State vectors</a></li><li><a href=#tracks>Tracks</a></li><li><a href=#flights>Flights</a></li><li><a href=#airport-activity>Airport activity</a></li></ul></li></ul></li><li><a href=#ads-b-data-in-postgis>ADS-B data in PostGIS</a><ul><li><a href=#database-creation>Database creation</a></li><li><a href=#plpython>PL/Python</a></li><li><a href=#geospatial-queries>Geospatial queries</a></li></ul></li><li><a href=#going-multidimensional>Going multidimensional</a><ul><li><a href=#crossed-paths>Crossed Paths</a></li><li><a href=#four-dimensions>Four dimensions</a><ul><li><a href=#closest-points-of-approach>Closest points of approach</a></li><li><a href=#searching-for-near-misses>Searching for near misses</a></li></ul></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><div id=ads-b-data class=anchor>ADS-B data></div><h2 class="relative group">ADS-B data
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ads-b-data aria-label=Anchor>#</a></span></h2><p>Can standard geospatial tools be used with transmissions from <a href=https://en.wikipedia.org/wiki/Automatic_Dependent_Surveillance%E2%80%93Broadcast target=_blank>Automatic Dependent Surveillance-Broadcast</a> (ADS-B) equipment aboard aircraft? I wanted to find out because unlike most geospatial data, ADS-B has a third dimension <em>and</em> a fourth dimension.</p><p>My geospatial analysis tool of choice is PostGIS, which has multidimensional geometry types and functions, but I had never really had cause to use them despite having coded support for additional dimensions when I developed <a href=https://plpygis.readthedocs.io/en/latest/ target=_blank>plpygis</a>.</p><p>This article describes the process of getting free ADS-B data, loading it into PostgreSQL and then manipulating it with PostGIS and Python.</p><div id=tools class=anchor>Tools></div><h3 class="relative group">Tools
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#tools aria-label=Anchor>#</a></span></h3><p>In addition to PostgreSQL and PostGIS, I used two Python modules: <a href=https://docs.python-requests.org/en/latest/ target=_blank>requests</a> and <a href=https://plpygis.readthedocs.io/en/latest/ target=_blank>plpygis</a>. These <em>must</em> be installed in a location from which PostgreSQL’s <a href=https://www.postgresql.org/docs/current/plpython.html target=_blank>PL/Python</a> can import them. I also used <a href=https://qgis.org/ target=_blank>QGIS</a> for visualization.</p><div id=aircraft-identities class=anchor>Aircraft identities></div><h3 class="relative group">Aircraft identities
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#aircraft-identities aria-label=Anchor>#</a></span></h3><p>Step one was learning about <a href=https://en.wikipedia.org/wiki/Aviation_transponder_interrogation_modes#ICAO_24-bit_address target=_blank>ICAO 24 addresses</a>, unique aircraft identifiers which are included in every ADS-B transmission.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> These are 24-bit values represented by a six-digit hexadecimal number, such as <code>A4DA1</code>. These codes are distinct from the registration numbers that are visible on an aircraft&rsquo;s body or tail.</p><p><figure><img class="my-0 rounded-md" srcset="/pages/ads-b/uk-76428_hub070e2e2e7aaad531f12524bcf9ae1ae_67418_330x0_resize_q75_h2_box_2.webp 330w,
/pages/ads-b/uk-76428_hub070e2e2e7aaad531f12524bcf9ae1ae_67418_660x0_resize_q75_h2_box_2.webp 660w,
/pages/ads-b/uk-76428_hub070e2e2e7aaad531f12524bcf9ae1ae_67418_1024x0_resize_q75_h2_box_2.webp 1024w,
/pages/ads-b/uk-76428_hub070e2e2e7aaad531f12524bcf9ae1ae_67418_1320x0_resize_q75_h2_box_2.webp 2x" src=/pages/ads-b/uk-76428_hub070e2e2e7aaad531f12524bcf9ae1ae_67418_660x0_resize_q75_h2_box_2.webp alt="Aircraft UK-76428"><figcaption>Uzbekistan Airways IL-76 with registration UK-76428</figcaption></figure></p><p>A single physical aircraft may have multiple ICAO 24 addresses over its lifetime but these change much less frequently than registration numbers.</p><p><figure><img class="my-0 rounded-md" srcset="/pages/ads-b/a5-rgh_hu093e91e6c02422376599cf73b2f505f8_218200_330x0_resize_q75_h2_box_2.webp 330w,
/pages/ads-b/a5-rgh_hu093e91e6c02422376599cf73b2f505f8_218200_660x0_resize_q75_h2_box_2.webp 660w,
/pages/ads-b/a5-rgh_hu093e91e6c02422376599cf73b2f505f8_218200_1024x0_resize_q75_h2_box_2.webp 1024w,
/pages/ads-b/a5-rgh_hu093e91e6c02422376599cf73b2f505f8_218200_1320x0_resize_q75_h2_box_2.webp 2x" src=/pages/ads-b/a5-rgh_hu093e91e6c02422376599cf73b2f505f8_218200_660x0_resize_q75_h2_box_2.webp alt="Aircraft A5-RGH"><figcaption>Drukair ATR-42 with the registration number A5-RGH (via <a href=https://www.planespotters.net/airframe/atr-42-f-hlia-amelia-international/e241md target=_blank>www.planespotters.net</a>)</figcaption></figure></p><p>The ATR-42 in the image above has moved between three airlines and therefore been registered under three different numbers … but also with two different ICAO 24 codes, <code>3a2270</code> and <code>39ad00</code>. The history of these alterations can be found in some databases, such as the one maintained by <a href=https://www.planespotters.net/airframe/atr-42-f-hlia-amelia-international/e241md target=_blank>Planespotters.net</a>.</p><div id=the-opensky-network class=anchor>The OpenSky Network></div><h3 class="relative group">The OpenSky Network
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-opensky-network aria-label=Anchor>#</a></span></h3><p>The <a href=https://opensky-network.org/ target=_blank>The OpenSky Network</a> provides free access to ADB-S data via a RESTful API. There is a <a href=https://openskynetwork.github.io/opensky-api/python.html target=_blank>Python client</a>, but I did not use it since it doesn’t implement everything that is available directly through the API.</p><p>An ICAO 24 address<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> is the basis for most OpenSky API calls, although it is possible to request data by searching for activity at a particular airport or region.</p><p>I created a free OpenSky account since the API documentation states that the <a href=https://openskynetwork.github.io/opensky-api/rest.html#limitations target=_blank>rate limits</a> are stricter for anonymous users. And although my experience is that the API behaviour does not always match the documentation, it seemed like a good idea to do what they recommend in this case.</p><div id=state-vectors class=anchor>State vectors></div><h4 class="relative group">State vectors
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#state-vectors aria-label=Anchor>#</a></span></h4><p>Equipped with an ICAO 24 number, I retrieved some actual flight data provided by OpenSky. A basic query also requires a specific time, with that time being represented as the number of seconds elapsed since the 1st of January 1970 (otherwise known as UNIX time). For example, the position of the ATR-42 above at 16:01:23 on the 11th of April, 2022 is requested by <a href="https://opensky-network.org/api/states/all?icao24=39ad00&amp;time=1649692883" target=_blank>https://opensky-network.org/api/states/all?icao24=39ad00&time=1649692883</a>.</p><p>The <a href=https://www.json.org/ target=_blank>JSON</a>-encoded response looks like the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=mi>1649692883</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;states&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;39ad00&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;AFR57AG &#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;France&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=mi>1649692879</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=mi>1649692882</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=mf>2.5172</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=mf>44.9426</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=mf>2263.14</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=mf>100.86</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=mf>24.08</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=mf>10.08</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=mf>2316.48</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The data transmitted by the aircraft is stored in the list of states and can be decoded through the <a href=https://openskynetwork.github.io/opensky-api/rest.html#response target=_blank>OpenSky documentation</a>. From this you know that the aircraft was operating as <a href=https://flightaware.com/live/flight/AFR57AG target=_blank>Air France 57AG</a>, that it recorded a barometric altitude of 2263.14 meters, that it had a ground speed of 100.86 meters/second and so on.</p><p>Back to my Il-76 in Tashkent, <a href=https://planefinder.net/data/aircraft/UK-76428 target=_blank>planefinder</a> tells me that the ICAO 24 code associated with UK-76428 is <code>507f87</code>. As it turns out, OpenSky doesn’t have any records of that particular airplane flying, which is, I suppose, an answer to my original question of what these planes might be up to: not much, or at least not much in the range of a receiver operated by someone participating in the OpenSky Network. But there are plenty of other planes in the sky to look at!</p><div id=tracks class=anchor>Tracks></div><h4 class="relative group">Tracks
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#tracks aria-label=Anchor>#</a></span></h4><p>OpenSky simplifies getting a series of state vectors by providing a tracks API endpoint, and although <a href=https://openskynetwork.github.io/opensky-api/rest.html#track-by-aircraft target=_blank>the documentation</a> states that this endpoint is <a href=https://github.com/openskynetwork/opensky-api/commit/fba493cfee35dfc6f1d1f01f84f68c4d04ab781d target=_blank>experimental</a>, I’ve had success in using it: <a href="https://opensky-network.org/api/tracks/?icao24=39ad00&amp;time=1649692883" target=_blank>https://opensky-network.org/api/tracks/?icao24=39ad00&time=1649692883</a>.</p><p>The response to the request above will contain some basic facts about the flight, including the first and last times at which it was observed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;icao24&#34;</span><span class=p>:</span> <span class=s2>&#34;39ad00&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;callsign&#34;</span><span class=p>:</span> <span class=s2>&#34;AFR57AG &#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;startTime&#34;</span><span class=p>:</span> <span class=mi>1649692883</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;endTime&#34;</span><span class=p>:</span> <span class=mi>1649696435</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;path&#34;</span><span class=p>:</span> <span class=p>[</span><span class=err>...</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The <code>path</code> element is a list of abbreviated state vectors showing the route the aircraft took on this flight. One of these vectors might look like the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=mi>1649693075</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=mf>45.129</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=mf>2.631</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=mi>3352</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=mi>23</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>These values are the time, latitude, longitude, barometric altitude, heading and whether the aircraft is on the ground respectively.<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></p><p>The one significant limitation with OpenSky is that these flight tracks are only available for flights from the last 30 days.</p><div id=flights class=anchor>Flights></div><h4 class="relative group">Flights
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#flights aria-label=Anchor>#</a></span></h4><p>The next endpoint that we’ll be using is <code>/flights/aircraft</code>, which lists all the flights taken by an aircraft: <a href="https://opensky-network.org/api/flights/aircraft/?icao24=39ad00&amp;begin=1609455600&amp;end=1609714800" target=_blank>https://opensky-network.org/api/flights/aircraft/?icao24=39ad00&begin=1609455600&end=1609714800</a>.</p><p>One flight in the list looks like the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;icao24&#34;</span><span class=p>:</span> <span class=s2>&#34;39ad00&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;firstSeen&#34;</span><span class=p>:</span> <span class=mi>1649692883</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;estDepartureAirport&#34;</span><span class=p>:</span> <span class=s2>&#34;LFLW&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;lastSeen&#34;</span><span class=p>:</span> <span class=mi>1649696438</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;estArrivalAirport&#34;</span><span class=p>:</span> <span class=s2>&#34;LFPO&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;callsign&#34;</span><span class=p>:</span> <span class=s2>&#34;AFR57AG &#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;estDepartureAirportHorizDistance&#34;</span><span class=p>:</span> <span class=mi>9750</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;estDepartureAirportVertDistance&#34;</span><span class=p>:</span> <span class=mi>1654</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;estArrivalAirportHorizDistance&#34;</span><span class=p>:</span> <span class=mi>3750</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;estArrivalAirportVertDistance&#34;</span><span class=p>:</span> <span class=mi>33</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;departureAirportCandidatesCount&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;arrivalAirportCandidatesCount&#34;</span><span class=p>:</span> <span class=mi>9</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The departure and arrival airports are estimates since these are not explicitly reported by the ADB-S data, so OpenSky infers them from what it observes; on occasion you will see an airport listed as <code>null</code> when there wasn’t enough data to establish what the plane’s origin or destination were.</p><p>Any time between <code>firstSeen</code> and <code>lastSeen</code> can be used with the <code>/tracks</code> endpoint above to get the entire path that the plane took on this flight.</p><div id=airport-activity class=anchor>Airport activity></div><h4 class="relative group">Airport activity
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#airport-activity aria-label=Anchor>#</a></span></h4><p>Two final endpoints that are interesting are <code>/flights/arrival</code> and <code>/flights/departure</code>, which will list all the flights that terminate or originate at a particular airport between two points in time.</p><div id=ads-b-data-in-postgis class=anchor>ADS-B data in PostGIS></div><h2 class="relative group">ADS-B data in PostGIS
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ads-b-data-in-postgis aria-label=Anchor>#</a></span></h2><div id=database-creation class=anchor>Database creation></div><h3 class="relative group">Database creation
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#database-creation aria-label=Anchor>#</a></span></h3><p>Once PostgreSQL and PostGIS are installed and your user has the right privileges, you can run the following on the command line:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>createdb opensky
</span></span></code></pre></div><p>Then open the database to interact with it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pgsql opensky
</span></span></code></pre></div><p>You first need to enable PostGIS:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>CREATE</span> <span class=k>EXTENSION</span> <span class=n>postgis</span><span class=p>;</span>
</span></span></code></pre></div><p>Create the table to store the flight data:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>flight</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=n>icao24</span>   <span class=nb>TEXT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>callsign</span> <span class=nb>TEXT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>dep_airp</span> <span class=nb>TEXT</span><span class=p>,</span> <span class=c1>-- departure airport
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>arr_airp</span> <span class=nb>TEXT</span><span class=p>,</span> <span class=c1>-- arrival airport
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>dep_time</span> <span class=nb>TIMESTAMP</span><span class=p>,</span> <span class=c1>-- departure time
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>arr_time</span> <span class=nb>TIMESTAMP</span><span class=p>,</span> <span class=c1>-- arrival time
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>geom</span> <span class=n>GEOMETRY</span><span class=p>(</span><span class=n>LINESTRINGZM</span><span class=p>,</span> <span class=mf>4326</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><p>The geometry type <code>LINESTRINGZM</code> means that each vertex in the path will have four dimensions: x and y (longitude and latitude), z (altitude) and m (the “measure” value, which will be used for time).</p><p>Finally, add an index but make it n-dimensional, which optimizes queries across all four dimensions.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>CREATE</span> <span class=k>INDEX</span> <span class=k>ON</span>
</span></span><span class=line><span class=cl>  <span class=n>flight</span>
</span></span><span class=line><span class=cl><span class=k>USING</span>
</span></span><span class=line><span class=cl>  <span class=n>gist</span> <span class=p>(</span><span class=n>geom</span> <span class=n>gist_geometry_ops_nd</span><span class=p>);</span>
</span></span></code></pre></div><div id=plpython class=anchor>PL/Python></div><h3 class="relative group">PL/Python
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#plpython aria-label=Anchor>#</a></span></h3><p>There are a few ways to bring the data from the OpenSky API into the database, but I used PL/Python, which means we’ll write a function in Python that will be run from inside the database. To make it easier to work with PostGIS, I also used <a href=https://plpygis.readthedocs.io/en/latest/ target=_blank>plpygis</a>, a small Python module that I created to help write PL/Python functions for geospatial data.</p><p>Start by enabling PL/Python:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>CREATE</span> <span class=k>LANGUAGE</span> <span class=n>plpython3u</span><span class=p>;</span>
</span></span></code></pre></div><p>Let’s start with a simple function that gets a list of flights an aircraft took between two dates. I provided my OpenSky credentials in the environment variables <code>OPENSKY_USER</code> and <code>OPENSKY_PASS</code>, but they could also be set directly in the script.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plpgsql data-lang=plpgsql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>REPLACE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>get_aircraft_flights</span><span class=p>(</span><span class=n>icao24</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span><span class=w> </span><span class=n>in_datebegin</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=n>in_dateend</span><span class=w> </span><span class=nb>DATE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>RETURNS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>TABLE</span><span class=w> </span><span class=p>(</span><span class=k>LIKE</span><span class=w> </span><span class=n>flight</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AS</span><span class=w> </span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>import</span><span class=w> </span><span class=n>os</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>OSUSER</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>os</span><span class=mf>.</span><span class=n>getenv</span><span class=p>(</span><span class=s>&#34;OPENSKY_USER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>OSPASS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>os</span><span class=mf>.</span><span class=n>getenv</span><span class=p>(</span><span class=s>&#34;OPENSKY_PASS&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>OSURL</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;https://opensky-network.org/api&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>datetime</span><span class=w> </span><span class=n>import</span><span class=w> </span><span class=n>datetime</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>dateutil</span><span class=w> </span><span class=n>import</span><span class=w> </span><span class=k>parser</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>requests</span><span class=w> </span><span class=n>import</span><span class=w> </span><span class=k>Session</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>requests</span><span class=mf>.</span><span class=n>auth</span><span class=w> </span><span class=n>import</span><span class=w> </span><span class=n>HTTPBasicAuth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>db</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>parser</span><span class=mf>.</span><span class=n>parse</span><span class=p>(</span><span class=n>in_datebegin</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>de</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>parser</span><span class=mf>.</span><span class=n>parse</span><span class=p>(</span><span class=n>in_dateend</span><span class=p>)</span><span class=mf>.</span><span class=k>replace</span><span class=p>(</span><span class=k>hour</span><span class=o>=</span><span class=mf>23</span><span class=p>,</span><span class=w> </span><span class=k>minute</span><span class=o>=</span><span class=mf>59</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>db</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=n>db</span><span class=mf>.</span><span class=nb>timestamp</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>de</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=n>de</span><span class=mf>.</span><span class=nb>timestamp</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>opensky</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>Session</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>opensky</span><span class=mf>.</span><span class=n>auth</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HTTPBasicAuth</span><span class=p>(</span><span class=n>OSUSER</span><span class=p>,</span><span class=w> </span><span class=n>OSPASS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>res</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>opensky</span><span class=mf>.</span><span class=k>get</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=n>OSURL</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;/flights/aircraft/&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=n>params</span><span class=o>=</span><span class=p>{</span><span class=s>&#34;icao24&#34;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>icao24</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                      </span><span class=s>&#34;begin&#34;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>db</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                      </span><span class=s>&#34;end&#34;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>de</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=n>status_code</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mf>200</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=nb>text</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>plpy</span><span class=mf>.</span><span class=n>info</span><span class=p>(</span><span class=n>res</span><span class=mf>.</span><span class=n>request</span><span class=mf>.</span><span class=n>url</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>flights</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[(</span><span class=n>icao24</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>f</span><span class=p>[</span><span class=s>&#34;callsign&#34;</span><span class=p>]</span><span class=mf>.</span><span class=k>strip</span><span class=p>()</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>f</span><span class=p>[</span><span class=s>&#34;callsign&#34;</span><span class=p>]</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>f</span><span class=p>[</span><span class=s>&#34;estDepartureAirport&#34;</span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>f</span><span class=p>[</span><span class=s>&#34;estArrivalAirport&#34;</span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>datetime</span><span class=mf>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=s>&#34;firstSeen&#34;</span><span class=p>]),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>datetime</span><span class=mf>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=s>&#34;lastSeen&#34;</span><span class=p>]),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>None</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                   </span><span class=k>for</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=nb>json</span><span class=p>()]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>flights</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>else</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>plpy</span><span class=mf>.</span><span class=n>info</span><span class=p>(</span><span class=n>res</span><span class=mf>.</span><span class=n>request</span><span class=mf>.</span><span class=n>url</span><span class=p>,</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=n>status_code</span><span class=p>,</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=nb>text</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$$</span><span class=w> </span><span class=k>LANGUAGE</span><span class=w> </span><span class=n>plpython3u</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>The function definition <code>get_aircraft_flights</code> takes three arguments, the ICAO 24 code discussed above plus a start and an end date. Returning <code>TABLE (LIKE flight)</code> is a rather useful way that PostgreSQL lets you force the output of a function to match exactly the definition of a table.<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup></p><p>The function makes a call to the OpenSky API to get all the flights for the aircraft between the two dates, and returns the results. It does not fill in the track for each flight, but we can write another function to do that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plpgsql data-lang=plpgsql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>REPLACE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>get_track</span><span class=p>(</span><span class=n>icao24</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span><span class=w> </span><span class=n>in_date</span><span class=w> </span><span class=nb>TIMESTAMP</span><span class=w> </span><span class=nb>WITH TIME ZONE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>RETURNS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>GEOMETRY</span><span class=p>(</span><span class=n>LINESTRINGZM</span><span class=p>,</span><span class=w> </span><span class=mf>4326</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AS</span><span class=w> </span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>import</span><span class=w> </span><span class=n>os</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>OSUSER</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>os</span><span class=mf>.</span><span class=n>getenv</span><span class=p>(</span><span class=s>&#34;OPENSKY_USER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>OSPASS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>os</span><span class=mf>.</span><span class=n>getenv</span><span class=p>(</span><span class=s>&#34;OPENSKY_PASS&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>OSURL</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;https://opensky-network.org/api&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>datetime</span><span class=w> </span><span class=n>import</span><span class=w> </span><span class=n>datetime</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>dateutil</span><span class=w> </span><span class=n>import</span><span class=w> </span><span class=k>parser</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>requests</span><span class=w> </span><span class=n>import</span><span class=w> </span><span class=k>Session</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>requests</span><span class=mf>.</span><span class=n>auth</span><span class=w> </span><span class=n>import</span><span class=w> </span><span class=n>HTTPBasicAuth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>plpygis</span><span class=w> </span><span class=n>import</span><span class=w> </span><span class=n>LineString</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>parser</span><span class=mf>.</span><span class=n>parse</span><span class=p>(</span><span class=n>in_date</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=n>dt</span><span class=mf>.</span><span class=nb>timestamp</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>opensky</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>Session</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>opensky</span><span class=mf>.</span><span class=n>auth</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HTTPBasicAuth</span><span class=p>(</span><span class=n>OSUSER</span><span class=p>,</span><span class=w> </span><span class=n>OSPASS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>res</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>opensky</span><span class=mf>.</span><span class=k>get</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>OSURL</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;/tracks/&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>params</span><span class=o>=</span><span class=p>{</span><span class=s>&#34;icao24&#34;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>icao24</span><span class=mf>.</span><span class=n>lower</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s>&#34;time&#34;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>dt</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=n>status_code</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mf>200</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=nb>text</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>plpy</span><span class=mf>.</span><span class=n>info</span><span class=p>(</span><span class=n>res</span><span class=mf>.</span><span class=n>request</span><span class=mf>.</span><span class=n>url</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>fl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=nb>json</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>LineString</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>[[</span><span class=n>v</span><span class=p>[</span><span class=mf>2</span><span class=p>],</span><span class=w> </span><span class=n>v</span><span class=p>[</span><span class=mf>1</span><span class=p>],</span><span class=w> </span><span class=n>v</span><span class=p>[</span><span class=mf>3</span><span class=p>],</span><span class=w> </span><span class=n>v</span><span class=p>[</span><span class=mf>0</span><span class=p>]]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>for</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>fl</span><span class=p>[</span><span class=s>&#34;path&#34;</span><span class=p>]])</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>else</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>plpy</span><span class=mf>.</span><span class=n>info</span><span class=p>(</span><span class=n>res</span><span class=mf>.</span><span class=n>request</span><span class=mf>.</span><span class=n>url</span><span class=p>,</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=n>status_code</span><span class=p>,</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=nb>text</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>None</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$$</span><span class=w> </span><span class=k>LANGUAGE</span><span class=w> </span><span class=n>plpython3u</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>Now you can use SQL on the results of this function as if it were a normal database table. For example if you want to know all the unique flight numbers flown by <code>39ad00</code> in the first week of May, you can query the OpenSky API like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>SELECT</span>
</span></span><span class=line><span class=cl>  <span class=k>DISTINCT</span> <span class=n>callsign</span>
</span></span><span class=line><span class=cl><span class=k>FROM</span>
</span></span><span class=line><span class=cl>  <span class=n>get_aircraft_flights</span><span class=p>(</span><span class=s1>&#39;c05f01&#39;</span><span class=p>,</span> <span class=s1>&#39;2022-05-01&#39;</span><span class=p>,</span> <span class=s1>&#39;2022-05-07&#39;</span><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=w> </span><span class=n>callsign</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>----------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=n>JZA653</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA652</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA270</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA283</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA651</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA161</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA399</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA300</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA157</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA460</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA801</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA349</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA279</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA322</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA658</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA164</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA282</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA153</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA156</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA295</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA147</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA400</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA810</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA800</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA654</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA803</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA160</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>JZA459</span><span class=w>
</span></span></span></code></pre></div><p>One issue that you will observe doing the above is that you are pulling data from the API with every query. It will be much better to have a local copy of the data to work with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>INSERT</span> <span class=k>INTO</span>
</span></span><span class=line><span class=cl>  <span class=n>flight</span>
</span></span><span class=line><span class=cl><span class=k>SELECT</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=k>FROM</span>
</span></span><span class=line><span class=cl>  <span class=n>get_aircraft_flights</span><span class=p>(</span><span class=s1>&#39;c05f01&#39;</span><span class=p>,</span> <span class=s1>&#39;2022-05-01&#39;</span><span class=p>,</span> <span class=s1>&#39;2022-05-07&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p>Now the same queries can be run locally from our <code>flight</code> table:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>SELECT</span> <span class=k>DISTINCT</span>
</span></span><span class=line><span class=cl>  <span class=n>callsign</span>
</span></span><span class=line><span class=cl><span class=k>FROM</span>
</span></span><span class=line><span class=cl>  <span class=n>flight</span><span class=p>;</span>
</span></span></code></pre></div><p>And how do we add the tracks?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>UPDATE</span>
</span></span><span class=line><span class=cl>  <span class=n>flight</span>
</span></span><span class=line><span class=cl><span class=k>SET</span>
</span></span><span class=line><span class=cl>  <span class=n>geom</span> <span class=o>=</span> <span class=n>get_track</span><span class=p>(</span><span class=n>icao24</span><span class=p>,</span> <span class=n>dep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>WHERE</span>
</span></span><span class=line><span class=cl>  <span class=nb>date</span><span class=p>(</span><span class=n>dep_time</span><span class=p>)</span> <span class=o>=</span> <span class=s1>&#39;2022-05-01&#39;</span><span class=p>;</span>
</span></span></code></pre></div><p>Remove the WHERE clause and you’ll add tracks to all the flights in your table (which could take a very long time depending on what you have put in there). To add geometries to all the flights without them, you can change the where clause to <code>WHERE geom IS NULL</code>.</p><p>And, of course, you can hook the table up to QGIS to see those flight paths.</p><p><figure><img class="my-0 rounded-md" srcset="/pages/ads-b/qgis_tracks_hu7babd5ede0af156abbcec22afaefcbdf_226560_330x0_resize_q75_h2_box_2.webp 330w,
/pages/ads-b/qgis_tracks_hu7babd5ede0af156abbcec22afaefcbdf_226560_660x0_resize_q75_h2_box_2.webp 660w,
/pages/ads-b/qgis_tracks_hu7babd5ede0af156abbcec22afaefcbdf_226560_1024x0_resize_q75_h2_box_2.webp 1024w,
/pages/ads-b/qgis_tracks_hu7babd5ede0af156abbcec22afaefcbdf_226560_1320x0_resize_q75_h2_box_2.webp 2x" src=/pages/ads-b/qgis_tracks_hu7babd5ede0af156abbcec22afaefcbdf_226560_660x0_resize_q75_h2_box_2.webp alt="Flight tracks in QGIS"><figcaption>Flight tracks rendered in QGIS</figcaption></figure></p><div id=geospatial-queries class=anchor>Geospatial queries></div><h3 class="relative group">Geospatial queries
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#geospatial-queries aria-label=Anchor>#</a></span></h3><p>With the data in PostGIS, let’s do some analysis.</p><p>Let’s start easy and say that you want to know how many kilometers <code>39ad00</code> flew on the 1st of May:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>SELECT</span>
</span></span><span class=line><span class=cl>  <span class=n>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span> <span class=k>AS</span> <span class=n>flights</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>SUM</span><span class=p>(</span><span class=n>ST_Length</span><span class=p>(</span><span class=n>geom</span><span class=o>::</span><span class=n>geography</span><span class=p>))</span> <span class=o>/</span> <span class=mf>1000</span> <span class=k>AS</span> <span class=n>distance</span>
</span></span><span class=line><span class=cl><span class=k>FROM</span>
</span></span><span class=line><span class=cl>  <span class=n>flight</span>
</span></span><span class=line><span class=cl><span class=k>WHERE</span>
</span></span><span class=line><span class=cl>  <span class=nb>date</span><span class=p>(</span><span class=n>dep_time</span><span class=p>)</span> <span class=o>=</span> <span class=s1>&#39;2022-05-01&#39;</span><span class=p>;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=w> </span><span class=n>flights</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=n>distance</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>---------+-------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>       </span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>1499</span><span class=p>.</span><span class=mi>689291267288</span><span class=w>
</span></span></span></code></pre></div><p>A little more advanced is seeing how often <code>39ad00</code> flew between two Canadian airports but travelled over the landmass of the United States to get there. To do this, I downloaded the administrative boundaries data set from <a href=https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_0_countries.zip target=_blank>NaturalEarth</a> and after unzipping it, I loaded it into the <code>opensky</code> database:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>shp2pgsql -s <span class=m>4326</span> -g geom ne_10m_admin_0_countries.shp country <span class=p>|</span> psql opensky
</span></span></code></pre></div><p>And the I ran the following query to find instances when the start and end of a flight were in Canada but at some point the flight path intersected with US territory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>SELECT</span>
</span></span><span class=line><span class=cl>  <span class=n>f</span><span class=mf>.</span><span class=n>callsign</span><span class=p>,</span> <span class=n>f</span><span class=mf>.</span><span class=n>dep_time</span><span class=p>,</span> <span class=n>f</span><span class=mf>.</span><span class=n>dep_airp</span><span class=p>,</span> <span class=n>f</span><span class=mf>.</span><span class=n>arr_airp</span>
</span></span><span class=line><span class=cl><span class=k>FROM</span>
</span></span><span class=line><span class=cl>  <span class=n>flight</span> <span class=k>AS</span> <span class=n>f</span><span class=p>,</span> <span class=n>country</span> <span class=k>AS</span> <span class=n>usa</span><span class=p>,</span> <span class=n>country</span> <span class=k>AS</span> <span class=n>canada</span>
</span></span><span class=line><span class=cl><span class=k>WHERE</span>
</span></span><span class=line><span class=cl>  <span class=n>usa</span><span class=mf>.</span><span class=k>name</span> <span class=o>=</span> <span class=s1>&#39;United States of America&#39;</span> <span class=k>AND</span>
</span></span><span class=line><span class=cl>  <span class=n>canada</span><span class=mf>.</span><span class=k>name</span> <span class=o>=</span> <span class=s1>&#39;Canada&#39;</span> <span class=k>AND</span>
</span></span><span class=line><span class=cl>  <span class=n>ST_Intersects</span><span class=p>(</span><span class=n>canada</span><span class=mf>.</span><span class=n>geom</span><span class=p>,</span> <span class=n>ST_StartPoint</span><span class=p>(</span><span class=n>f</span><span class=mf>.</span><span class=n>geom</span><span class=p>))</span> <span class=k>AND</span>
</span></span><span class=line><span class=cl>  <span class=n>ST_Intersects</span><span class=p>(</span><span class=n>canada</span><span class=mf>.</span><span class=n>geom</span><span class=p>,</span> <span class=n>ST_EndPoint</span><span class=p>(</span><span class=n>f</span><span class=mf>.</span><span class=n>geom</span><span class=p>))</span> <span class=k>AND</span>
</span></span><span class=line><span class=cl>  <span class=n>ST_Intersects</span><span class=p>(</span><span class=n>usa</span><span class=mf>.</span><span class=n>geom</span><span class=p>,</span> <span class=n>f</span><span class=mf>.</span><span class=n>geom</span><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl> <span class=n>callsign</span> <span class=o>|</span>      <span class=n>dep_time</span>       <span class=o>|</span> <span class=n>dep_airp</span> <span class=o>|</span> <span class=n>arr_airp</span>
</span></span><span class=line><span class=cl><span class=c1>----------+---------------------+----------+----------
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=n>JZA474</span>   <span class=o>|</span> <span class=mf>2022</span><span class=o>-</span><span class=mf>05</span><span class=o>-</span><span class=mf>13</span> <span class=mf>01</span><span class=p>:</span><span class=mf>10</span><span class=p>:</span><span class=mf>16</span> <span class=o>|</span> <span class=n>CYCD</span>     <span class=o>|</span> <span class=n>CYYC</span>
</span></span></code></pre></div><p>Showing that particular flight in QGIS, we can see how it did, in fact, pass over the United States during its flight.</p><p><figure><img class="my-0 rounded-md" srcset="/pages/ads-b/qgis_jza474_hua6aa09bbb69b5e724f472c7e828b7d98_182848_330x0_resize_q75_h2_box_2.webp 330w,
/pages/ads-b/qgis_jza474_hua6aa09bbb69b5e724f472c7e828b7d98_182848_660x0_resize_q75_h2_box_2.webp 660w,
/pages/ads-b/qgis_jza474_hua6aa09bbb69b5e724f472c7e828b7d98_182848_1024x0_resize_q75_h2_box_2.webp 1024w,
/pages/ads-b/qgis_jza474_hua6aa09bbb69b5e724f472c7e828b7d98_182848_1320x0_resize_q75_h2_box_2.webp 2x" src=/pages/ads-b/qgis_jza474_hua6aa09bbb69b5e724f472c7e828b7d98_182848_660x0_resize_q75_h2_box_2.webp alt="Flight JZA-474 in QGIS"><figcaption>Jazz Air flight 474 crossed Washington state on its departure from Nanaimo</figcaption></figure></p><div id=going-multidimensional class=anchor>Going multidimensional></div><h2 class="relative group">Going multidimensional
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#going-multidimensional aria-label=Anchor>#</a></span></h2><div id=crossed-paths class=anchor>Crossed Paths></div><h3 class="relative group">Crossed Paths
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#crossed-paths aria-label=Anchor>#</a></span></h3><p>With some data in our <code>flight</code> table, we can do multidimensional analysis using three dimensions as described in the <a href=https://postgis.net/workshops/postgis-intro/3d.html target=_blank>PostGIS documentation</a>.</p><p>Let&rsquo;s start by seeing if any of the flights had an exact intersections of their flight paths.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>SELECT</span>
</span></span><span class=line><span class=cl>  <span class=n>a</span><span class=mf>.</span><span class=n>callsign</span><span class=p>,</span> <span class=n>a</span><span class=mf>.</span><span class=n>dep_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>b</span><span class=mf>.</span><span class=n>callsign</span><span class=p>,</span> <span class=n>b</span><span class=mf>.</span><span class=n>dep_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>ST_AsText</span><span class=p>(</span><span class=n>ST_Intersection</span><span class=p>(</span><span class=n>a</span><span class=mf>.</span><span class=n>geom</span><span class=p>,</span> <span class=n>b</span><span class=mf>.</span><span class=n>geom</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>FROM</span>
</span></span><span class=line><span class=cl>  <span class=n>flight</span> <span class=k>AS</span> <span class=n>a</span><span class=p>,</span> <span class=n>flight</span> <span class=k>AS</span> <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=k>WHERE</span>
</span></span><span class=line><span class=cl>  <span class=n>a</span><span class=mf>.</span><span class=n>dep_time</span> <span class=o>&gt;</span> <span class=n>b</span><span class=mf>.</span><span class=n>dep_time</span> <span class=k>AND</span>
</span></span><span class=line><span class=cl>  <span class=n>ST_Intersects</span><span class=p>(</span><span class=n>ST_Force3D</span><span class=p>(</span><span class=n>a</span><span class=mf>.</span><span class=n>geom</span><span class=p>),</span> <span class=n>ST_Force3D</span><span class=p>(</span><span class=n>b</span><span class=mf>.</span><span class=n>geom</span><span class=p>));</span>
</span></span></code></pre></div><p>Note that we are forcing the geometries to be three-dimensional and not four-dimensional. A two-dimentional intersection would ignore altitude completely, while a four-dimensional intersection would be asking for two planes that crossed paths at the exact same point at the exact same time, otherwise known as a mid-air collision.</p><p>Among the results is something like this, where we can see the exact three-dimensional point at which the paths of Jazz Air flights 168 and 150 intersected one another.</p><pre tabindex=0><code> JZA168   | 2022-06-07 04:49:17 | JZA150   | 2022-06-06 18:15:24 | POINT Z (-123.28160909937012 48.72753520085094 609)
</code></pre><p>The intersection point is expressed in three-dimensional <a href=https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry target=_blank>WKT</a>, <code>POINT Z (-123.28160909937012 48.72753520085094 609)</code>, where the <code>609</code> indicates that the planes were at an altitude of 609 metres or about 2000 feet, a reasonable altitude for planes on approach to an airport.</p><p><figure><img class="my-0 rounded-md" srcset="/pages/ads-b/conjunction_hubafce49a0b1da568214a20a0eaf01805_1890413_330x0_resize_box_3.png 330w,
/pages/ads-b/conjunction_hubafce49a0b1da568214a20a0eaf01805_1890413_660x0_resize_box_3.png 660w,
/pages/ads-b/conjunction_hubafce49a0b1da568214a20a0eaf01805_1890413_1024x0_resize_box_3.png 1024w,
/pages/ads-b/conjunction_hubafce49a0b1da568214a20a0eaf01805_1890413_1320x0_resize_box_3.png 2x" src=/pages/ads-b/conjunction_hubafce49a0b1da568214a20a0eaf01805_1890413_660x0_resize_box_3.png alt="Flight tracks in QGIS"><figcaption>Flight tracks for JZA168 and JZA150 crossing paths</figcaption></figure></p><p>Click <a href=map/index.html target=_blank>here</a> to see the 3d model above (vertical scale has been exaggerated).</p><div id=four-dimensions class=anchor>Four dimensions></div><h3 class="relative group">Four dimensions
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#four-dimensions aria-label=Anchor>#</a></span></h3><div id=closest-points-of-approach class=anchor>Closest points of approach></div><h4 class="relative group">Closest points of approach
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#closest-points-of-approach aria-label=Anchor>#</a></span></h4><p>A four-dimensional intersection is a mid-air collision, and Canada&rsquo;s Civil Aviation Daily Occurrence Reporting System has a queryable database of &ldquo;occurrences&rdquo; on the <a href=https://wwwapps.tc.gc.ca/Saf-Sec-Sur/2/cadors-screaq/ws.aspx target=_blank>Transport Canada website</a>. By filtering on the string &ldquo;TCAS&rdquo;<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>, I found <a href=https://wwwapps.tc.gc.ca/saf-sec-sur/2/cadors-screaq/rd.aspx?occdtefrom%3d2022-06-12%26occdteto%3d2022-07-13%26srchfldcd%3d6%26txt%3dTCAS%26srchtype%3d1%26rt%3dWS%26hypl%3dy%26cnum%3d2022O1187 target=_blank>the following incident</a>:</p><blockquote><p>UPDATE: TSB Report #A22O0076: C-FAXD, a Boeing 737 MAX 8 aircraft operated by Sunwing Airlines Inc, was conducting flight SWG443 from Punta Cana International Airport (PUJ/MDPC), Dominican Republic, to Toronto Pearson International Airport (CYYZ), ON. While on final approach into CYYZ for Runway 33L, the flight crew received a Traffic Alert and Collision Avoidance System (TCAS) resolution advisory (RA) with C-GJVT, an Airbus 320-200 aircraft operated by Air Canada conducting flight ACA264 from Winnipeg/James Armstrong Richardson International Airport (CYWG), MB, to CYYZ, which was on final approach for Runway 33R. SWG443 followed the TCAS RA and aborted the approach to the left. Both aircraft came to a minimum lateral separation of 0.6 Nautical Miles and a minimum vertical separation of 500 feet. SWG443 was at an altitude of 3500 feet and ACA264 at 3000 feet, abeam to each other, on approach for Runways 33L and 33R. SWG443 and ACA264 landed without further incident.</p></blockquote><p>I wanted to see if I could replicate this narrative in ADS-B data. The first problem is that all the data in the <code>flight</code> table comes from the same airplane, so I added a new function that ingests all the tracks arriving or departing from a specific airport.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plpgsql data-lang=plpgsql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>REPLACE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>get_airport_flights</span><span class=p>(</span><span class=n>airport</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span><span class=w> </span><span class=n>in_datebegin</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=n>in_dateend</span><span class=w> </span><span class=nb>DATE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>RETURNS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>TABLE</span><span class=w> </span><span class=p>(</span><span class=k>LIKE</span><span class=w> </span><span class=n>flight</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AS</span><span class=w> </span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>import</span><span class=w> </span><span class=n>os</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>OSUSER</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>os</span><span class=mf>.</span><span class=n>getenv</span><span class=p>(</span><span class=s>&#34;OPENSKY_USER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>OSPASS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>os</span><span class=mf>.</span><span class=n>getenv</span><span class=p>(</span><span class=s>&#34;OPENSKY_PASS&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>OSURL</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Thttps://opensky-network.org/api&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>datetime</span><span class=w> </span><span class=n>import</span><span class=w> </span><span class=n>datetime</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>dateutil</span><span class=w> </span><span class=n>import</span><span class=w> </span><span class=k>parser</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>requests</span><span class=w> </span><span class=n>import</span><span class=w> </span><span class=k>Session</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>requests</span><span class=mf>.</span><span class=n>auth</span><span class=w> </span><span class=n>import</span><span class=w> </span><span class=n>HTTPBasicAuth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>db</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>parser</span><span class=mf>.</span><span class=n>parse</span><span class=p>(</span><span class=n>in_datebegin</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>de</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>parser</span><span class=mf>.</span><span class=n>parse</span><span class=p>(</span><span class=n>in_dateend</span><span class=p>)</span><span class=mf>.</span><span class=k>replace</span><span class=p>(</span><span class=k>hour</span><span class=o>=</span><span class=mf>23</span><span class=p>,</span><span class=w> </span><span class=k>minute</span><span class=o>=</span><span class=mf>59</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>db</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=n>db</span><span class=mf>.</span><span class=nb>timestamp</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>de</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=n>de</span><span class=mf>.</span><span class=nb>timestamp</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>opensky</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>Session</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>opensky</span><span class=mf>.</span><span class=n>auth</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HTTPBasicAuth</span><span class=p>(</span><span class=n>OSUSER</span><span class=p>,</span><span class=w> </span><span class=n>OSPASS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>endpoint</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=p>[</span><span class=s>&#34;arrival&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;departure&#34;</span><span class=p>]:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>res</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>opensky</span><span class=mf>.</span><span class=k>get</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>OSURL</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;/flights/{}/&#34;</span><span class=mf>.</span><span class=n>format</span><span class=p>(</span><span class=n>endpoint</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>params</span><span class=o>=</span><span class=p>{</span><span class=s>&#34;airport&#34;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>airport</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s>&#34;begin&#34;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>db</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s>&#34;end&#34;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>de</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=n>status_code</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mf>200</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=nb>text</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=n>plpy</span><span class=mf>.</span><span class=n>info</span><span class=p>(</span><span class=n>res</span><span class=mf>.</span><span class=n>request</span><span class=mf>.</span><span class=n>url</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=k>for</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=nb>json</span><span class=p>():</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=n>f</span><span class=p>[</span><span class=s>&#34;firstSeen&#34;</span><span class=p>]</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=n>f</span><span class=p>[</span><span class=s>&#34;lastSeen&#34;</span><span class=p>]:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=k>continue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>yield</span><span class=w> </span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=s>&#34;icao24&#34;</span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                   </span><span class=n>f</span><span class=p>[</span><span class=s>&#34;callsign&#34;</span><span class=p>]</span><span class=mf>.</span><span class=k>strip</span><span class=p>()</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>f</span><span class=p>[</span><span class=s>&#34;callsign&#34;</span><span class=p>]</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                   </span><span class=n>f</span><span class=p>[</span><span class=s>&#34;estDepartureAirport&#34;</span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                   </span><span class=n>f</span><span class=p>[</span><span class=s>&#34;estArrivalAirport&#34;</span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                   </span><span class=n>datetime</span><span class=mf>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=s>&#34;firstSeen&#34;</span><span class=p>]),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                   </span><span class=n>datetime</span><span class=mf>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=s>&#34;lastSeen&#34;</span><span class=p>]),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                   </span><span class=k>None</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>else</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=n>plpy</span><span class=mf>.</span><span class=n>info</span><span class=p>(</span><span class=n>res</span><span class=mf>.</span><span class=n>request</span><span class=mf>.</span><span class=n>url</span><span class=p>,</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=n>status_code</span><span class=p>,</span><span class=w> </span><span class=n>res</span><span class=mf>.</span><span class=nb>text</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$$</span><span class=w> </span><span class=k>LANGUAGE</span><span class=w> </span><span class=n>plpython3u</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>I populated it with the flights to and from CYYZ on the date of the incident.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>tcas</span> <span class=p>(</span><span class=k>LIKE</span> <span class=n>flight</span><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>tcas</span>
</span></span><span class=line><span class=cl><span class=k>SELECT</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=k>FROM</span>
</span></span><span class=line><span class=cl>  <span class=n>get_airport_flights</span><span class=p>(</span><span class=s1>&#39;CYYZ&#39;</span><span class=p>,</span> <span class=s1>&#39;2022-06-18&#39;</span><span class=p>,</span> <span class=s1>&#39;2022-06-18&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p>I could have ingested all the tracks for every row in the table, but since I already knew the affected flights, I just focused on those.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>UPDATE</span>
</span></span><span class=line><span class=cl>  <span class=n>tcas</span>
</span></span><span class=line><span class=cl><span class=k>SET</span>
</span></span><span class=line><span class=cl>  <span class=n>geom</span> <span class=o>=</span> <span class=n>get_track</span><span class=p>(</span><span class=n>icao24</span><span class=p>,</span> <span class=n>dep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>WHERE</span>
</span></span><span class=line><span class=cl>  <span class=n>callsign</span> <span class=k>IN</span> <span class=p>(</span><span class=s1>&#39;ACA264&#39;</span><span class=p>,</span> <span class=s1>&#39;SWG443&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p>After adding the tracks, the PostGIS function <code>ST_ClosestPointOfApproach</code> can tell us where along the timelines of two flights are they at their closest proximity. We will, however, want to have the geometry reprojected into a spatial reference system that makes distance calculations using metres - not latitude and longitude - since that is what the altitude is measured in. Since the data set is clustered around Toronto, EPSG:7991 is a good choice.</p><p><code>ST_ClosestPointOfApproach</code> finds the measure value at which two tracks are closest to one another. <code>ST_DistanceCPA</code>provides the actual three-dimensional distance between the two tracks at this closest point of approach.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>WITH</span> <span class=n>flights</span> <span class=k>AS</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=k>SELECT</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=mf>.</span><span class=n>callsign</span> <span class=k>AS</span> <span class=n>fa</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span><span class=mf>.</span><span class=n>callsign</span> <span class=k>AS</span> <span class=n>fb</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ST_Transform</span><span class=p>(</span><span class=n>a</span><span class=mf>.</span><span class=n>geom</span><span class=p>,</span> <span class=mf>7991</span><span class=p>)</span> <span class=k>AS</span> <span class=n>ga</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ST_Transform</span><span class=p>(</span><span class=n>b</span><span class=mf>.</span><span class=n>geom</span><span class=p>,</span> <span class=mf>7991</span><span class=p>)</span> <span class=k>AS</span> <span class=n>gb</span>
</span></span><span class=line><span class=cl>  <span class=k>FROM</span>
</span></span><span class=line><span class=cl>    <span class=n>tcas</span> <span class=k>AS</span> <span class=n>a</span><span class=p>,</span> <span class=n>tcas</span> <span class=k>AS</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>  <span class=k>WHERE</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=mf>.</span><span class=n>callsign</span> <span class=o>=</span> <span class=s1>&#39;ACA264&#39;</span> <span class=k>AND</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span><span class=mf>.</span><span class=n>callsign</span> <span class=o>=</span> <span class=s1>&#39;SWG443&#39;</span>    
</span></span><span class=line><span class=cl><span class=p>),</span> <span class=n>cpa</span> <span class=k>AS</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=k>SELECT</span>
</span></span><span class=line><span class=cl>    <span class=n>fa</span><span class=p>,</span> <span class=n>fb</span><span class=p>,</span> <span class=n>ga</span><span class=p>,</span> <span class=n>gb</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ST_ClosestPointOfApproach</span><span class=p>(</span><span class=n>ga</span><span class=p>,</span> <span class=n>gb</span><span class=p>)</span> <span class=k>AS</span> <span class=n>m</span>
</span></span><span class=line><span class=cl>  <span class=k>FROM</span>
</span></span><span class=line><span class=cl>    <span class=n>flights</span>
</span></span><span class=line><span class=cl><span class=p>),</span> <span class=n>points</span> <span class=k>AS</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=k>SELECT</span>
</span></span><span class=line><span class=cl>    <span class=n>fa</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>fb</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ST_Force3DZ</span><span class=p>(</span><span class=n>ST_GeometryN</span><span class=p>(</span><span class=n>ST_LocateAlong</span><span class=p>(</span><span class=n>ga</span><span class=p>,</span> <span class=n>m</span><span class=p>),</span> <span class=mf>1</span><span class=p>))</span> <span class=k>AS</span> <span class=n>pa</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ST_Force3DZ</span><span class=p>(</span><span class=n>ST_GeometryN</span><span class=p>(</span><span class=n>ST_LocateAlong</span><span class=p>(</span><span class=n>gb</span><span class=p>,</span> <span class=n>m</span><span class=p>),</span> <span class=mf>1</span><span class=p>))</span> <span class=k>AS</span> <span class=n>pb</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ST_DistanceCPA</span><span class=p>(</span><span class=n>ga</span><span class=p>,</span> <span class=n>gb</span><span class=p>)</span> <span class=k>AS</span> <span class=n>distance</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span>
</span></span><span class=line><span class=cl>  <span class=k>FROM</span>
</span></span><span class=line><span class=cl>    <span class=n>cpa</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>SELECT</span>
</span></span><span class=line><span class=cl>  <span class=n>to_timestamp</span><span class=p>(</span><span class=n>m</span><span class=p>)</span> <span class=k>AT</span> <span class=nb>TIME</span> <span class=k>ZONE</span> <span class=s1>&#39;UTC&#39;</span> <span class=k>AS</span> <span class=nb>time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>round</span><span class=p>(</span><span class=n>distance</span><span class=p>)</span> <span class=k>AS</span> <span class=n>separation</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>round</span><span class=p>(</span><span class=n>ST_Distance</span><span class=p>(</span><span class=n>ST_Force2D</span><span class=p>(</span><span class=n>pa</span><span class=p>),</span> <span class=n>ST_Force2D</span><span class=p>(</span><span class=n>pb</span><span class=p>)))</span> <span class=k>AS</span> <span class=n>lateral_separation</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>round</span><span class=p>(</span><span class=n>abs</span><span class=p>(</span><span class=n>ST_Z</span><span class=p>(</span><span class=n>pa</span><span class=p>)</span> <span class=o>-</span> <span class=n>ST_Z</span><span class=p>(</span><span class=n>pb</span><span class=p>)))</span> <span class=k>AS</span> <span class=n>vertical_separation</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>fa</span> <span class=k>AS</span> <span class=n>a</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>fb</span> <span class=k>AS</span> <span class=n>b</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>ST_AsText</span><span class=p>(</span><span class=n>ST_Transform</span><span class=p>(</span><span class=n>pa</span><span class=p>,</span> <span class=mf>4326</span><span class=p>),</span> <span class=mf>3</span><span class=p>)</span> <span class=k>AS</span> <span class=n>a_position</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>ST_AsText</span><span class=p>(</span><span class=n>ST_Transform</span><span class=p>(</span><span class=n>pb</span><span class=p>,</span> <span class=mf>4326</span><span class=p>),</span> <span class=mf>3</span><span class=p>)</span> <span class=k>AS</span> <span class=n>b_position</span>
</span></span><span class=line><span class=cl><span class=k>FROM</span>
</span></span><span class=line><span class=cl>  <span class=n>points</span><span class=p>;</span>
</span></span></code></pre></div><p>According to Transport Canada, the lateral separation at 22:39 UTC should be 0.6 nautical miles, which is is 1111 metres, and the vertical separation should be approximately 500 feet. The ADS-B data doesn&rsquo;t exactly replicate those findings but it&rsquo;s not hugely far off.</p><pre tabindex=0><code>        time         | separation | lateral_separation | vertical_separation |   a    |   b    |            a_position            |          b_position          
---------------------+------------+--------------------+---------------------+--------+--------+----------------------------------+------------------------------
 2022-06-18 22:38:07 |       1119 |               1075 |                 310 | ACA264 | SWG443 | POINT Z (-79.448 43.542 604.234) | POINT Z (-79.457 43.536 914)
</code></pre><p>The altitude of the two flights does not match the altitudes stated by Transport Canada; however, the altitude reported by these two aircraft on the ground at Toronto was 0, so adding ~170m to account for the airport&rsquo;s elevation does bring us into that range.</p><p><figure><img class="my-0 rounded-md" srcset="/pages/ads-b/tcas_hud66c566284d2b50433230db64ed2c102_1589247_330x0_resize_box_3.png 330w,
/pages/ads-b/tcas_hud66c566284d2b50433230db64ed2c102_1589247_660x0_resize_box_3.png 660w,
/pages/ads-b/tcas_hud66c566284d2b50433230db64ed2c102_1589247_1024x0_resize_box_3.png 1024w,
/pages/ads-b/tcas_hud66c566284d2b50433230db64ed2c102_1589247_1320x0_resize_box_3.png 2x" src=/pages/ads-b/tcas_hud66c566284d2b50433230db64ed2c102_1589247_660x0_resize_box_3.png alt="Paths and closest points of approach for each aircraft"><figcaption>Flight tracks for ACA264 and SWG443 and their positions when at their closest</figcaption></figure></p><div id=searching-for-near-misses class=anchor>Searching for near misses></div><h4 class="relative group">Searching for near misses
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#searching-for-near-misses aria-label=Anchor>#</a></span></h4><p>Lastly, I wanted to see if there were any &ldquo;close calls&rdquo; like the one above that were <em>not</em> reported in the Transport Canada database.</p><p>Let&rsquo;s load the in-bound and out-bound flights at Victoria International Airport (YYJ) on a single day:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>flight</span>
</span></span><span class=line><span class=cl><span class=k>SELECT</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=k>FROM</span>
</span></span><span class=line><span class=cl>  <span class=n>get_airport_flights</span><span class=p>(</span><span class=s1>&#39;CYYJ&#39;</span><span class=p>,</span> <span class=s1>&#39;2022-06-15&#39;</span><span class=p>,</span> <span class=s1>&#39;2022-06-15&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p>From this we will see for all flights that have any temporal overlap, there is a single time at which the two flights were closest to one another.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>SELECT</span>
</span></span><span class=line><span class=cl>  <span class=n>to_timestamp</span><span class=p>(</span><span class=n>ST_ClosestPointOfApproach</span><span class=p>(</span><span class=n>ST_Transform</span><span class=p>(</span><span class=n>a</span><span class=mf>.</span><span class=n>geom</span><span class=p>,</span> <span class=mf>3005</span><span class=p>),</span> <span class=n>ST_Transform</span><span class=p>(</span><span class=n>b</span><span class=mf>.</span><span class=n>geom</span><span class=p>,</span> <span class=mf>3005</span><span class=p>)))</span> <span class=k>AS</span> <span class=nb>time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>a</span><span class=mf>.</span><span class=n>callsign</span> <span class=k>AS</span> <span class=n>flight_a</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>b</span><span class=mf>.</span><span class=n>callsign</span> <span class=k>AS</span> <span class=n>flight_b</span>
</span></span><span class=line><span class=cl><span class=k>FROM</span>
</span></span><span class=line><span class=cl>  <span class=n>flight</span> <span class=k>as</span> <span class=n>a</span><span class=p>,</span> <span class=n>flight</span> <span class=k>as</span> <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=k>WHERE</span>
</span></span><span class=line><span class=cl>  <span class=n>a</span><span class=mf>.</span><span class=n>dep_time</span> <span class=o>&gt;</span> <span class=n>b</span><span class=mf>.</span><span class=n>dep_time</span> <span class=k>AND</span>
</span></span><span class=line><span class=cl>  <span class=n>ST_ClosestPointOfApproach</span><span class=p>(</span><span class=n>a</span><span class=mf>.</span><span class=n>geom</span><span class=p>,</span> <span class=n>b</span><span class=mf>.</span><span class=n>geom</span><span class=p>)</span> <span class=k>IS</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>;</span>
</span></span></code></pre></div><p>An abbreviated output would look like the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=w>             </span><span class=n>time</span><span class=w>              </span><span class=o>|</span><span class=w> </span><span class=n>flight_a</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>flight_b</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-------------------------------+----------+----------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>15</span><span class=w> </span><span class=mi>16</span><span class=p>:</span><span class=mi>50</span><span class=p>:</span><span class=mi>34</span><span class=p>.</span><span class=mi>289124</span><span class=o>+</span><span class=mi>02</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>WSW209</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>ROU1901</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>15</span><span class=w> </span><span class=mi>16</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mi>25</span><span class=o>+</span><span class=mi>02</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>WSW209</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>MAL8072</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>15</span><span class=w> </span><span class=mi>16</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mi>25</span><span class=o>+</span><span class=mi>02</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>WSW209</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>WJA209</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>15</span><span class=w> </span><span class=mi>23</span><span class=p>:</span><span class=mi>20</span><span class=p>:</span><span class=mi>26</span><span class=o>+</span><span class=mi>02</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>ASP654</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>WJA196</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>15</span><span class=w> </span><span class=mi>23</span><span class=p>:</span><span class=mi>16</span><span class=p>:</span><span class=mi>29</span><span class=p>.</span><span class=mi>999995</span><span class=o>+</span><span class=mi>02</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>ASP654</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>FLE515</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>15</span><span class=w> </span><span class=mi>23</span><span class=p>:</span><span class=mi>01</span><span class=p>:</span><span class=mi>11</span><span class=o>+</span><span class=mi>02</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>ASP654</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>CGFHA</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>15</span><span class=w> </span><span class=mi>23</span><span class=p>:</span><span class=mi>11</span><span class=p>:</span><span class=mi>15</span><span class=o>+</span><span class=mi>02</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>ASP654</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>CL604KGN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>15</span><span class=w> </span><span class=mi>23</span><span class=p>:</span><span class=mi>01</span><span class=p>:</span><span class=mi>03</span><span class=o>+</span><span class=mi>02</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>ASP654</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>CGBMO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>15</span><span class=w> </span><span class=mi>23</span><span class=p>:</span><span class=mi>11</span><span class=p>:</span><span class=mi>15</span><span class=o>+</span><span class=mi>02</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>ASP654</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>ROU1902</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>15</span><span class=w> </span><span class=mi>23</span><span class=p>:</span><span class=mi>01</span><span class=p>:</span><span class=mi>03</span><span class=o>+</span><span class=mi>02</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>ASP654</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>CGBMO</span><span class=w>
</span></span></span></code></pre></div><p>Let&rsquo;s say we want to find instances where two aircraft were within 1000 metres of one another:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-postgresql data-lang=postgresql><span class=line><span class=cl><span class=k>WITH</span> <span class=n>flights</span> <span class=k>AS</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=k>SELECT</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=mf>.</span><span class=n>callsign</span> <span class=k>AS</span> <span class=n>fa</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span><span class=mf>.</span><span class=n>callsign</span> <span class=k>AS</span> <span class=n>fb</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ST_Transform</span><span class=p>(</span><span class=n>a</span><span class=mf>.</span><span class=n>geom</span><span class=p>,</span> <span class=mf>3005</span><span class=p>)</span> <span class=k>AS</span> <span class=n>ga</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ST_Transform</span><span class=p>(</span><span class=n>b</span><span class=mf>.</span><span class=n>geom</span><span class=p>,</span> <span class=mf>3005</span><span class=p>)</span> <span class=k>AS</span> <span class=n>gb</span>
</span></span><span class=line><span class=cl>  <span class=k>FROM</span>
</span></span><span class=line><span class=cl>    <span class=n>flight</span> <span class=k>AS</span> <span class=n>a</span><span class=p>,</span> <span class=n>flight</span> <span class=k>AS</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>  <span class=k>WHERE</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=mf>.</span><span class=n>dep_time</span> <span class=o>&gt;</span> <span class=n>b</span><span class=mf>.</span><span class=n>dep_time</span>
</span></span><span class=line><span class=cl><span class=p>),</span> <span class=n>cpa</span> <span class=k>AS</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=k>SELECT</span>
</span></span><span class=line><span class=cl>    <span class=n>fa</span><span class=p>,</span> <span class=n>fb</span><span class=p>,</span> <span class=n>ga</span><span class=p>,</span> <span class=n>gb</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ST_DistanceCPA</span><span class=p>(</span><span class=n>ga</span><span class=p>,</span><span class=n>gb</span><span class=p>)</span> <span class=k>AS</span> <span class=n>sd</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ST_ClosestPointOfApproach</span><span class=p>(</span><span class=n>ga</span><span class=p>,</span> <span class=n>gb</span><span class=p>)</span> <span class=k>AS</span> <span class=n>m</span>
</span></span><span class=line><span class=cl>  <span class=k>FROM</span>
</span></span><span class=line><span class=cl>    <span class=n>flights</span>
</span></span><span class=line><span class=cl>  <span class=k>WHERE</span>
</span></span><span class=line><span class=cl>    <span class=n>ST_ClosestPointOfApproach</span><span class=p>(</span><span class=n>ga</span><span class=p>,</span> <span class=n>gb</span><span class=p>)</span> <span class=k>IS</span> <span class=k>NOT</span> <span class=k>NULL</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>SELECT</span>
</span></span><span class=line><span class=cl>  <span class=n>m</span> <span class=k>AS</span> <span class=n>unix_time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>round</span><span class=p>(</span><span class=n>sd</span><span class=p>)</span> <span class=k>AS</span> <span class=n>separation</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>fa</span> <span class=k>AS</span> <span class=n>flight_a</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>fb</span> <span class=k>AS</span> <span class=n>flight_b</span>
</span></span><span class=line><span class=cl><span class=k>FROM</span>
</span></span><span class=line><span class=cl>  <span class=n>cpa</span>
</span></span><span class=line><span class=cl><span class=k>WHERE</span>
</span></span><span class=line><span class=cl>  <span class=n>sd</span> <span class=o>&lt;=</span> <span class=mf>1000</span><span class=p>;</span>
</span></span></code></pre></div><p>This gives us the following output, including one remarkable outlier where two planes were within just 31 metres of one another (at least as reported by the ADS-B data)!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=w>     </span><span class=n>unix_time</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>separation</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>flight_a</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>flight_b</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--------------------+------------+----------+----------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>         </span><span class=mi>1655318221</span><span class=w> </span><span class=o>|</span><span class=w>        </span><span class=mi>782</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>N90422</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>N50KA</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=mi>1655317602</span><span class=p>.</span><span class=mi>2365394</span><span class=w> </span><span class=o>|</span><span class=w>         </span><span class=mi>31</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>CGGGO</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>WEN3354</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=mi>1655246393</span><span class=p>.</span><span class=mi>916999</span><span class=w> </span><span class=o>|</span><span class=w>        </span><span class=mi>984</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>CGVEA</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>CFSUV</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=mi>1655253184</span><span class=p>.</span><span class=mi>6499498</span><span class=w> </span><span class=o>|</span><span class=w>        </span><span class=mi>996</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>CGLDP</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>JZA161</span><span class=w>
</span></span></span></code></pre></div><p>A separation of 31 metres is so small that it&rsquo;s worth double checking the data to see what those two aircraft were doing at exactly 1655317602.2365394.</p><pre tabindex=0><code>SELECT ST_AsText(geom)
FROM (
  SELECT (ST_DumpPoints(flight.geom)).*
  FROM flight WHERE callsign = &#39;CGGGO&#39;) AS g;
</code></pre><p>From the points in flight CGGGO, we see that there were ADS-B state vectors recorded two minutes before and 13 seconds after 1655317602, but no state vector exactly <em>at</em> 1655317602.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=w>  </span><span class=n>path</span><span class=w> </span><span class=o>|</span><span class=w>                            </span><span class=n>st_astext</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>------+-----------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=err>{</span><span class=mi>1</span><span class=err>}</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218224</span><span class=p>.</span><span class=mi>1390170476</span><span class=w> </span><span class=mi>455564</span><span class=p>.</span><span class=mi>6965150813</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317419</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>2</span><span class=err>}</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218370</span><span class=p>.</span><span class=mi>96000034</span><span class=w> </span><span class=mi>455381</span><span class=p>.</span><span class=mi>88762515073</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317425</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>3</span><span class=err>}</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218440</span><span class=p>.</span><span class=mi>9541452834</span><span class=w> </span><span class=mi>455284</span><span class=p>.</span><span class=mi>7816067032</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317428</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>4</span><span class=err>}</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218456</span><span class=p>.</span><span class=mi>977321602</span><span class=w> </span><span class=mi>455252</span><span class=p>.</span><span class=mi>1045787118</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317429</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>5</span><span class=err>}</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218559</span><span class=p>.</span><span class=mi>022961798</span><span class=w> </span><span class=mi>455089</span><span class=p>.</span><span class=mi>6465681435</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317434</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>6</span><span class=err>}</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218582</span><span class=p>.</span><span class=mi>8252591728</span><span class=w> </span><span class=mi>455046</span><span class=p>.</span><span class=mi>18074272043</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317436</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>7</span><span class=err>}</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218614</span><span class=p>.</span><span class=mi>8748292197</span><span class=w> </span><span class=mi>454980</span><span class=p>.</span><span class=mi>82785217743</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317437</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>8</span><span class=err>}</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218623</span><span class=p>.</span><span class=mi>5907024834</span><span class=w> </span><span class=mi>454947</span><span class=p>.</span><span class=mi>84267283714</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317438</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>9</span><span class=err>}</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218624</span><span class=p>.</span><span class=mi>5285217932</span><span class=w> </span><span class=mi>454925</span><span class=p>.</span><span class=mi>6466826303</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317439</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>10</span><span class=err>}</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218634</span><span class=p>.</span><span class=mi>1823688783</span><span class=w> </span><span class=mi>454870</span><span class=p>.</span><span class=mi>46557313844</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317440</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>11</span><span class=err>}</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218635</span><span class=p>.</span><span class=mi>5891432345</span><span class=w> </span><span class=mi>454837</span><span class=p>.</span><span class=mi>17162861006</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317441</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>12</span><span class=err>}</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218636</span><span class=p>.</span><span class=mi>5269924412</span><span class=w> </span><span class=mi>454814</span><span class=p>.</span><span class=mi>975674214</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317442</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>13</span><span class=err>}</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218632</span><span class=p>.</span><span class=mi>4999741595</span><span class=w> </span><span class=mi>454736</span><span class=p>.</span><span class=mi>98104434885</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317444</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>14</span><span class=err>}</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218627</span><span class=p>.</span><span class=mi>066055597</span><span class=w> </span><span class=mi>454692</span><span class=p>.</span><span class=mi>2803657774</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317445</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>15</span><span class=err>}</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218598</span><span class=p>.</span><span class=mi>019306817</span><span class=w> </span><span class=mi>454513</span><span class=p>.</span><span class=mi>16918261163</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317450</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>16</span><span class=err>}</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218524</span><span class=p>.</span><span class=mi>7346475082</span><span class=w> </span><span class=mi>453820</span><span class=p>.</span><span class=mi>77799814986</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317466</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>17</span><span class=err>}</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218516</span><span class=p>.</span><span class=mi>20432238</span><span class=w> </span><span class=mi>453675</span><span class=p>.</span><span class=mi>88890926924</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=mi>1655317469</span><span class=p>)</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>18</span><span class=err>}</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218497</span><span class=p>.</span><span class=mi>63525764</span><span class=w> </span><span class=mi>453074</span><span class=p>.</span><span class=mi>757360585</span><span class=w> </span><span class=mi>304</span><span class=w> </span><span class=mi>1655317482</span><span class=p>)</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>19</span><span class=err>}</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218212</span><span class=p>.</span><span class=mi>1383303064</span><span class=w> </span><span class=mi>445414</span><span class=p>.</span><span class=mi>31268528895</span><span class=w> </span><span class=mi>609</span><span class=w> </span><span class=mi>1655317615</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>20</span><span class=err>}</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218196</span><span class=p>.</span><span class=mi>3919528325</span><span class=w> </span><span class=mi>445091</span><span class=p>.</span><span class=mi>2794655764</span><span class=w> </span><span class=mi>609</span><span class=w> </span><span class=mi>1655317620</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>21</span><span class=err>}</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218224</span><span class=p>.</span><span class=mi>3295626454</span><span class=w> </span><span class=mi>442858</span><span class=p>.</span><span class=mi>135926426</span><span class=w> </span><span class=mi>914</span><span class=w> </span><span class=mi>1655317663</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>{</span><span class=mi>22</span><span class=err>}</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>ZM</span><span class=w> </span><span class=p>(</span><span class=mi>1218221</span><span class=p>.</span><span class=mi>4493862633</span><span class=w> </span><span class=mi>441879</span><span class=p>.</span><span class=mi>82805676176</span><span class=w> </span><span class=mi>914</span><span class=w> </span><span class=mi>1655317684</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><p>What PostGIS is doing is interpolating the coordinates when the exact measure value does not exist in the data set:</p><pre tabindex=0><code class=language-postrsql data-lang=postrsql>WITH point AS (
  SELECT
    callsign,
    ST_GeometryN(ST_LocateAlong(ST_Transform(a.geom, 3005), 1655317602.2365394), 1) AS pa
  FROM
    flight AS a
  WHERE
    a.callsign in (&#39;CGGGO&#39;, &#39;WEN3354&#39;)
)
SELECT
  callsign,
  ST_AsText(ST_Force3DZ(pa), 0) AS position
FROM
  point;
</code></pre><p>Compare the results with the table above and you&rsquo;ll see how the values fit between the two highlighted lines.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=w> </span><span class=n>callsign</span><span class=w> </span><span class=o>|</span><span class=w>           </span><span class=k>position</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>----------+------------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=n>CGGGO</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>Z</span><span class=w> </span><span class=p>(</span><span class=mi>1218240</span><span class=w> </span><span class=mi>446149</span><span class=w> </span><span class=mi>580</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>WEN3354</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>POINT</span><span class=w> </span><span class=n>Z</span><span class=w> </span><span class=p>(</span><span class=mi>1218249</span><span class=w> </span><span class=mi>446149</span><span class=w> </span><span class=mi>609</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>Apply a little Pythagorean theorem and the distance was, in fact, 31 metres. Well &mldr; sort of. Because of gaps in the ADS-B data, all PostGIS can do is <em>estimate</em> where the planes actually were. But if those estimates were correct, then the rest of the math does, in fact, check out!</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>These are also sometimes called Mode-S codes.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>ICAO 24 numbers are often found in upper case online, but most OpenSky API endpoints accept them only in lower case.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Note that the latitude/longitude ordering switches between the <code>/states</code> and <code>/tracks</code> endpoints!&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>One disadvantage, however, is that the function is tied to this table.&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>Traffic Collision Avoidance System.&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></br></br></div><script>var oid="views_pages/ads-b/index.md",oid_likes="likes_pages/ads-b/index.md"</script><script type=text/javascript src=/js/page.min.0e49973b4ad0a382c7c6012d8bff8226316642daabc4f8a20477bd08674f3da6e2fa993bc20ad4f51e7c5bb68e6f913a207a7c4fe37ea0e7b806894afce0a64e.js integrity="sha512-DkmXO0rQo4LHxgEti/+CJjFmQtqrxPiiBHe9CGdPPabi+pk7wgrU9R58W7aOb5E6IHp8T+N+oOe4BolK/OCmTg=="></script></section><footer class="pt-8 max-w-prose print:hidden"></footer></article><div class="pointer-events-none absolute top-[100vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.2166d3adac1679c00a75161830ab5725d3efc0e3d3f8c2453fb01d0907948436c25f0f8a7ad824322fa22f3f9c85fd4d0a1d5c856f53b862157da25a57dc3d52.js integrity="sha512-IWbTrawWecAKdRYYMKtXJdPvwOPT+MJFP7AdCQeUhDbCXw+KetgkMi+iLz+chf1NCh1chW9TuGIVfaJaV9w9Ug=="></script></footer></div></body></html>